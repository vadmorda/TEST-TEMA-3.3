<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Test 3 - La vida urbana en la Edad Media</title>
<style>
    * { box-sizing: border-box; }

    body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
            "Segoe UI", Arial, sans-serif;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at 0% 0%, #38bdf8 0, transparent 45%),
                    radial-gradient(circle at 100% 100%, #a855f7 0, transparent 45%),
                    radial-gradient(circle at 0% 100%, #22c55e 0, transparent 40%),
                    #020617;
        color: #0f172a;
    }

    .shell {
        width: 100%;
        max-width: 900px;
        padding: 20px;
    }

    .card {
        position: relative;
        background: rgba(15, 23, 42, 0.82);
        border-radius: 24px;
        padding: 24px 26px 22px;
        box-shadow: 0 22px 60px rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.35);
        backdrop-filter: blur(18px);
        color: #e5e7eb;
        overflow: hidden;
    }

    .card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.18), transparent 55%),
                    radial-gradient(circle at 100% 100%, rgba(168, 85, 247, 0.18), transparent 55%);
        opacity: 0.9;
        pointer-events: none;
    }

    .card-inner {
        position: relative;
        z-index: 1;
    }

    h1 {
        margin: 0 0 3px;
        text-align: center;
        font-size: 1.45rem;
        font-weight: 700;
        letter-spacing: 0.02em;
        color: #f9fafb;
    }

    .tagline {
        text-align: center;
        font-size: 0.9rem;
        color: #9ca3af;
        margin-bottom: 16px;
    }

    .pill-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-bottom: 14px;
        font-size: 0.8rem;
        color: #9ca3af;
    }
    .pill {
        padding: 5px 11px;
        border-radius: 999px;
        border: 1px solid rgba(148, 163, 184, 0.6);
        background: rgba(15, 23, 42, 0.8);
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }
    .pill span.dot {
        display: inline-block;
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: #22c55e;
    }

    .progress-wrap {
        margin-bottom: 10px;
    }
    .progress-bar-bg {
        width: 100%;
        height: 9px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(55, 65, 81, 0.9);
        overflow: hidden;
    }
    .progress-bar-fill {
        height: 100%;
        width: 0%;
        border-radius: 999px;
        background: linear-gradient(90deg, #22c55e, #38bdf8, #a855f7);
        box-shadow: 0 0 8px rgba(56, 189, 248, 0.8);
        transition: width 0.28s ease;
    }
    .progress-label {
        margin-top: 4px;
        font-size: 0.78rem;
        text-align: right;
        color: #9ca3af;
    }

    .question-block {
        margin-top: 12px;
    }

    .question-text {
        margin-bottom: 12px;
    }
    .q-es {
        display: block;
        font-size: 1.02rem;
        font-weight: 600;
        color: #e5e7eb;
        margin-bottom: 3px;
    }
    .q-ua {
        display: block;
        font-size: 0.94rem;
        font-style: italic;
        color: #cbd5f5;
        opacity: 0.9;
    }

    .options {
        margin-top: 10px;
    }

    .option {
        border-radius: 14px;
        border: 1px solid rgba(148, 163, 184, 0.5);
        padding: 9px 11px 8px;
        margin-bottom: 8px;
        display: flex;
        align-items: flex-start;
        gap: 8px;
        cursor: pointer;
        background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.18), transparent 60%);
        transition: border-color 0.15s ease, transform 0.05s ease, background 0.15s ease;
    }
    .option:hover {
        border-color: #38bdf8;
        transform: translateY(-1px);
        background: radial-gradient(circle at 0 0, rgba(56, 189, 248, 0.22), transparent 65%);
    }
    .option input {
        margin-top: 4px;
        accent-color: #38bdf8;
        cursor: pointer;
    }
    .option-text {
        font-size: 0.95rem;
        color: #e5e7eb;
    }
    .option-text .es {
        display: block;
        font-weight: 500;
    }
    .option-text .ua {
        display: block;
        font-size: 0.9rem;
        font-style: italic;
        color: #cbd5f5;
        opacity: 0.95;
        margin-top: 2px;
    }

    .short-answer {
        width: 100%;
        margin-top: 8px;
        padding: 10px 12px;
        border-radius: 14px;
        border: 1px solid rgba(148, 163, 184, 0.7);
        background: rgba(15, 23, 42, 0.8);
        color: #e5e7eb;
        font-size: 0.97rem;
        outline: none;
        transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }
    .short-answer::placeholder {
        color: #6b7280;
    }
    .short-answer:focus {
        border-color: #38bdf8;
        box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.55);
        background: rgba(15, 23, 42, 0.95);
    }

    .nav-row {
        margin-top: 18px;
        display: flex;
        justify-content: space-between;
        gap: 8px;
    }

    .btn {
        border-radius: 999px;
        border: none;
        padding: 9px 18px;
        font-size: 0.92rem;
        font-weight: 500;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: transform 0.07s ease, box-shadow 0.2s ease, background 0.15s ease, color 0.15s ease;
        white-space: nowrap;
    }

    .btn-primary {
        background: linear-gradient(135deg, #38bdf8, #6366f1);
        color: #0f172a;
        box-shadow: 0 14px 30px rgba(56, 189, 248, 0.45);
    }
    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 18px 40px rgba(56, 189, 248, 0.6);
        background: linear-gradient(135deg, #22c55e, #6366f1);
    }

    .btn-ghost {
        background: transparent;
        color: #e5e7eb;
        border: 1px solid rgba(148, 163, 184, 0.7);
    }
    .btn-ghost:hover {
        background: rgba(15, 23, 42, 0.85);
        transform: translateY(-1px);
    }

    .btn:disabled {
        opacity: 0.4;
        cursor: default;
        transform: none;
        box-shadow: none;
    }

    .hint {
        margin-top: 6px;
        font-size: 0.78rem;
        color: #9ca3af;
    }

    .hidden { display: none; }

    #result-card h2 {
        font-size: 1.3rem;
    }

    .summary {
        margin-top: 10px;
        font-size: 0.96rem;
        color: #e5e7eb;
    }

    .summary strong {
        color: #a5b4fc;
    }

    .list-fails {
        margin-top: 12px;
        max-height: 220px;
        overflow-y: auto;
        padding-right: 6px;
        font-size: 0.9rem;
        color: #e5e7eb;
    }

    .list-fails li {
        margin-bottom: 8px;
        padding-bottom: 6px;
        border-bottom: 1px dashed rgba(148, 163, 184, 0.45);
    }

    .list-fails .es {
        display: block;
        font-weight: 500;
    }
    .list-fails .ua {
        display: block;
        font-style: italic;
        color: #cbd5f5;
        margin-top: 2px;
    }

    .retry-row {
        margin-top: 16px;
        text-align: center;
    }

    @media (max-width: 640px) {
        .card {
            padding: 18px 16px 16px;
            border-radius: 18px;
        }
        h1 {
            font-size: 1.2rem;
        }
        .nav-row {
            flex-direction: column-reverse;
        }
        .btn {
            width: 100%;
            justify-content: center;
        }
        .progress-label {
            text-align: left;
        }
    }
</style>
</head>
<body>
<div class="shell">

    <!-- TARJETA DEL TEST -->
    <div id="test-card" class="card">
        <div class="card-inner">
            <h1>Test 3 ¬∑ La vida urbana en la Edad Media</h1>
            <div class="tagline">Geograf√≠a e Historia ¬∑ Espa√±ol üá™üá∏ ¬∑ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ üá∫üá¶</div>

            <div class="pill-row">
                <div class="pill">
                    <span class="dot"></span>
                    <span>Bloque 3 ¬∑ Ciudades medievales</span>
                </div>
                <div class="pill">
                    <span>Modo pr√°ctica</span>
                </div>
            </div>

            <div class="progress-wrap">
                <div class="progress-bar-bg">
                    <div id="progress-bar" class="progress-bar-fill"></div>
                </div>
                <div id="progress-label" class="progress-label"></div>
            </div>

            <div id="question-container" class="question-block"></div>
        </div>
    </div>

    <!-- TARJETA DE RESULTADOS -->
    <div id="result-card" class="card hidden">
        <div class="card-inner" id="result-content"></div>
    </div>
</div>

<script>
// -----------------------------
// PREGUNTAS TEST 3 ‚Äì Vida urbana
// -----------------------------
const preguntas = [
    {
        tipo: "multi",
        es: "¬øEntre qu√© siglos se produjo el renacimiento urbano en Europa?",
        ua: "–ú—ñ–∂ —è–∫–∏–º–∏ —Å—Ç–æ–ª—ñ—Ç—Ç—è–º–∏ –≤—ñ–¥–±—É–ª–æ—Å—è –º—ñ—Å—å–∫–µ –≤—ñ–¥—Ä–æ–¥–∂–µ–Ω–Ω—è –≤ –Ñ–≤—Ä–æ–ø—ñ?",
        opciones: [
            { es: "Entre los siglos IX y X", ua: "–ú—ñ–∂ IX —ñ X —Å—Ç." },           // 0
            { es: "Entre los siglos XI y XIII", ua: "–ú—ñ–∂ XI —ñ XIII —Å—Ç." },     // 1 ‚úî
            { es: "Entre los siglos XIV y XV", ua: "–ú—ñ–∂ XIV —ñ XV —Å—Ç." }        // 2
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        es: "¬øCu√°l fue una causa del crecimiento de las ciudades?",
        ua: "–Ø–∫–∞ –±—É–ª–∞ –æ–¥–Ω—ñ—î—é –∑ –ø—Ä–∏—á–∏–Ω –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è –º—ñ—Å—Ç?",
        opciones: [
            { es: "Las nuevas t√©cnicas agr√≠colas necesitaban menos mano de obra", ua: "–ù–æ–≤—ñ —Å—ñ–ª—å—Å—å–∫–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫—ñ —Ç–µ—Ö–Ω—ñ–∫–∏ –ø–æ—Ç—Ä–µ–±—É–≤–∞–ª–∏ –º–µ–Ω—à–µ —Ä–æ–±–æ—á–æ—ó —Å–∏–ª–∏" }, // 0 ‚úî
            { es: "Las ciudades prohibieron el comercio", ua: "–ú—ñ—Å—Ç–∞ –∑–∞–±–æ—Ä–æ–Ω–∏–ª–∏ —Ç–æ—Ä–≥—ñ–≤–ª—é" },                                                                // 1
            { es: "Se destruyeron los caminos", ua: "–ë—É–ª–∏ –∑—Ä—É–π–Ω–æ–≤–∞–Ω—ñ —à–ª—è—Ö–∏" }                                                                              // 2
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        es: "¬øQu√© ocurr√≠a con los siervos que viv√≠an m√°s de un a√±o en una ciudad?",
        ua: "–©–æ —Å—Ç–∞–≤–∞–ª–æ—Å—è —ñ–∑ —Å–µ–ª—è–Ω–∞–º–∏-–Ω–µ–≤—ñ–ª—å–Ω–∏–∫–∞–º–∏, —è–∫—ñ –ø—Ä–æ–∂–∏–ª–∏ –≤ –º—ñ—Å—Ç—ñ –±—ñ–ª—å—à–µ —Ä–æ–∫—É?",
        opciones: [
            { es: "Segu√≠an siendo siervos", ua: "–í–æ–Ω–∏ –∑–∞–ª–∏—à–∞–ª–∏—Å—è –Ω–µ–≤—ñ–ª—å–Ω–∏–∫–∞–º–∏" },                          // 0
            { es: "Pasaban a ser libres", ua: "–í–æ–Ω–∏ —Å—Ç–∞–≤–∞–ª–∏ –≤—ñ–ª—å–Ω–∏–º–∏" },                                   // 1 ‚úî
            { es: "Se convert√≠an en nobles", ua: "–í–æ–Ω–∏ —Å—Ç–∞–≤–∞–ª–∏ —à–ª—è—Ö—Ç–æ—é" }                                  // 2
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        es: "Las ciudades medievales se convirtieron en centros...",
        ua: "–°–µ—Ä–µ–¥–Ω—å–æ–≤—ñ—á–Ω—ñ –º—ñ—Å—Ç–∞ —Å—Ç–∞–ª–∏ —Ü–µ–Ω—Ç—Ä–∞–º–∏...",
        opciones: [
            { es: "Religiosos, pol√≠ticos y econ√≥micos", ua: "–†–µ–ª—ñ–≥—ñ–π–Ω–∏–º–∏, –ø–æ–ª—ñ—Ç–∏—á–Ω–∏–º–∏ —Ç–∞ –µ–∫–æ–Ω–æ–º—ñ—á–Ω–∏–º–∏" },  // 0 ‚úî
            { es: "Solo militares", ua: "–õ–∏—à–µ –≤—ñ–π—Å—å–∫–æ–≤–∏–º–∏" },                                               // 1
            { es: "Solo agr√≠colas", ua: "–õ–∏—à–µ —Å—ñ–ª—å—Å—å–∫–æ–≥–æ—Å–ø–æ–¥–∞—Ä—Å—å–∫–∏–º–∏" }                                     // 2
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        es: "¬øQu√© era el fuero de una ciudad?",
        ua: "–©–æ —Ç–∞–∫–µ –º—ñ—Å—å–∫–∏–π —Ñ—É–µ—Ä–æ?",
        opciones: [
            { es: "Un tipo de impuesto urbano", ua: "–í–∏–¥ –º—ñ—Å—å–∫–æ–≥–æ –ø–æ–¥–∞—Ç–∫—É" },                             // 0
            { es: "Un documento con derechos y privilegios concedido por el rey", ua: "–î–æ–∫—É–º–µ–Ω—Ç —ñ–∑ –ø—Ä–∞–≤–∞–º–∏ —Ç–∞ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏, –Ω–∞–¥–∞–Ω–∏–º–∏ –∫–æ—Ä–æ–ª–µ–º" }, // 1 ‚úî
            { es: "Una muralla defensiva", ua: "–û–±–æ—Ä–æ–Ω–Ω–∏–π –º—É—Ä" }                                           // 2
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        es: "¬øC√≥mo se llamaba el √≥rgano de gobierno de la ciudad?",
        ua: "–Ø–∫ –Ω–∞–∑–∏–≤–∞–≤—Å—è –æ—Ä–≥–∞–Ω –º—ñ—Å—å–∫–æ–≥–æ —Å–∞–º–æ–≤—Ä—è–¥—É–≤–∞–Ω–Ω—è?",
        opciones: [
            { es: "Ayuntamiento o concejo", ua: "–ú—É–Ω—ñ—Ü–∏–ø–∞–ª—ñ—Ç–µ—Ç –∞–±–æ —Ä–∞–¥–∞" },   // 0 ‚úî
            { es: "Parlamento europeo", ua: "–Ñ–≤—Ä–æ–ø–µ–π—Å—å–∫–∏–π –ø–∞—Ä–ª–∞–º–µ–Ω—Ç" },       // 1
            { es: "Corte feudal", ua: "–§–µ–æ–¥–∞–ª—å–Ω–∏–π –¥–≤—ñ—Ä" }                     // 2
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        es: "¬øQui√©nes formaban la √©lite urbana?",
        ua: "–•—Ç–æ –Ω–∞–ª–µ–∂–∞–≤ –¥–æ –º—ñ—Å—å–∫–æ—ó –µ–ª—ñ—Ç–∏?",
        opciones: [
            { es: "Campesinos sin tierras", ua: "–°–µ–ª—è–Ω–∏ –±–µ–∑ –∑–µ–º–ª—ñ" },                                     // 0
            { es: "Familias ricas de mercaderes, artesanos importantes y alto clero", ua: "–ë–∞–≥–∞—Ç—ñ —Ä–æ–¥–∏–Ω–∏ –∫—É–ø—Ü—ñ–≤, –≤–ø–ª–∏–≤–æ–≤—ñ —Ä–µ–º—ñ—Å–Ω–∏–∫–∏ —Ç–∞ –≤–∏—â–µ –º—ñ—Å—å–∫–µ –¥—É—Ö–æ–≤–µ–Ω—Å—Ç–≤–æ" }, // 1 ‚úî
            { es: "Solo estudiantes y escribanos", ua: "–õ–∏—à–µ —Å—Ç—É–¥–µ–Ω—Ç–∏ –π –ø–∏—Å–∞—Ä—ñ" }                         // 2
        ],
        correcta: 1
    },
    {
        tipo: "multi",
        es: "¬øQu√© √≥rdenes mendicantes surgieron en las ciudades?",
        ua: "–Ø–∫—ñ –∂–µ–±—Ä–∞—Ü—å–∫—ñ –æ—Ä–¥–µ–Ω–∏ –∑‚Äô—è–≤–∏–ª–∏—Å—è –≤ –º—ñ—Å—Ç–∞—Ö?",
        opciones: [
            { es: "Franciscana y dominica", ua: "–§—Ä–∞–Ω—Ü–∏—Å–∫–∞–Ω—Å—å–∫–∏–π —Ç–∞ –¥–æ–º—ñ–Ω—ñ–∫–∞–Ω—Å—å–∫–∏–π" }, // 0 ‚úî
            { es: "Benedictina y cisterciense", ua: "–ë–µ–Ω–µ–¥–∏–∫—Ç–∏–Ω—Å—å–∫–∏–π —Ç–∞ —Ü–∏—Å—Ç–µ—Ä—Ü—ñ–∞–Ω—Å—å–∫–∏–π" }, // 1
            { es: "Templaria y hospitalaria", ua: "–¢–∞–º–ø–ª—ñ—î—Ä—Å—å–∫–∏–π —Ç–∞ –≥–æ—Å–ø—ñ—Ç–∞–ª—å—î—Ä—Å—å–∫–∏–π" } // 2
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        es: "¬øC√≥mo se llamaban los barrios donde viv√≠an jud√≠os y musulmanes?",
        ua: "–Ø–∫ –Ω–∞–∑–∏–≤–∞–ª–∏—Å—è –∫–≤–∞—Ä—Ç–∞–ª–∏, –¥–µ –∂–∏–ª–∏ —é–¥–µ—ó —Ç–∞ –º—É—Å—É–ª—å–º–∞–Ω–∏?",
        opciones: [
            { es: "Juder√≠as y morer√≠as", ua: "–Æ–¥–µ–π—Å—å–∫—ñ —Ç–∞ –º–∞–≤—Ä–∏—Ç–∞–Ω—Å—å–∫—ñ –∫–≤–∞—Ä—Ç–∞–ª–∏" }, // 0 ‚úî
            { es: "Castillos y aldeas", ua: "–ó–∞–º–∫–∏ —Ç–∞ —Å–µ–ª–∞" },                      // 1
            { es: "Campos y huertas", ua: "–ü–æ–ª—è —Ç–∞ –≥–æ—Ä–æ–¥–∏" }                        // 2
        ],
        correcta: 0
    },
    {
        tipo: "multi",
        es: "¬øCu√°l era el centro de la vida urbana?",
        ua: "–©–æ –±—É–ª–æ —Ü–µ–Ω—Ç—Ä–æ–º –º—ñ—Å—å–∫–æ–≥–æ –∂–∏—Ç—Ç—è?",
        opciones: [
            { es: "La plaza del mercado", ua: "–†–∏–Ω–∫–æ–≤–∞ –ø–ª–æ—â–∞" },              // 0 ‚úî
            { es: "Las murallas exteriores", ua: "–ó–æ–≤–Ω—ñ—à–Ω—ñ –º—É—Ä–∏" },           // 1
            { es: "Los cementerios", ua: "–ö–ª–∞–¥–æ–≤–∏—â–∞" }                        // 2
        ],
        correcta: 0
    },

    // 5 CORTAS
    {
        tipo: "corta",
        es: "¬øC√≥mo se llamaban los habitantes de las ciudades?",
        ua: "–Ø–∫ –Ω–∞–∑–∏–≤–∞–ª–∏—Å—è –º–µ—à–∫–∞–Ω—Ü—ñ –º—ñ—Å—Ç?",
        respuesta: "burgueses"
    },
    {
        tipo: "corta",
        es: "Escribe el nombre del documento con los derechos de la ciudad.",
        ua: "–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∑ –ø—Ä–∞–≤–∞–º–∏ –º—ñ—Å—Ç–∞.",
        respuesta: "fuero"
    },
    {
        tipo: "corta",
        es: "Escribe el nombre del √≥rgano de gobierno urbano (una palabra).",
        ua: "–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤—É –º—ñ—Å—å–∫–æ–≥–æ –æ—Ä–≥–∞–Ω—É –≤–ª–∞–¥–∏ (–æ–¥–Ω–µ —Å–ª–æ–≤–æ).",
        respuesta: "ayuntamiento"
    },
    {
        tipo: "corta",
        es: "Escribe el nombre de una orden mendicante mencionada en el texto.",
        ua: "–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤—É –æ–¥–Ω–æ–≥–æ –∑ –∂–µ–±—Ä–∞—Ü—å–∫–∏—Ö –æ—Ä–¥–µ–Ω—ñ–≤ —ñ–∑ —Ç–µ–∫—Å—Ç—É.",
        respuesta: "franciscanos"
    },
    {
        tipo: "corta",
        es: "¬øC√≥mo se llamaban los barrios donde viv√≠an los jud√≠os?",
        ua: "–Ø–∫ –Ω–∞–∑–∏–≤–∞–ª–∏—Å—è –∫–≤–∞—Ä—Ç–∞–ª–∏, –¥–µ –∂–∏–ª–∏ —é–¥–µ—ó?",
        respuesta: "juder√≠as"
    }
];

// -----------------------------
// L√ìGICA: ORDEN ALEATORIO
// -----------------------------
let orden = [...preguntas.keys()];

function barajar(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}
barajar(orden);

let indice = 0; // posici√≥n dentro de 'orden'
let respuestasUsuario = new Array(preguntas.length).fill(null);

function actualizarProgreso() {
    const barra = document.getElementById("progress-bar");
    const label = document.getElementById("progress-label");
    const porcentaje = ((indice + 1) / preguntas.length) * 100;
    barra.style.width = porcentaje + "%";
    label.textContent = `Pregunta ${indice + 1} de ${preguntas.length}`;
}

function renderPregunta() {
    const cont = document.getElementById("question-container");
    const idxPregunta = orden[indice];
    const q = preguntas[idxPregunta];

    actualizarProgreso();

    let html = `
        <div class="question-text">
            <span class="q-es">${q.es}</span>
            <span class="q-ua">${q.ua}</span>
        </div>
    `;

    if (q.tipo === "multi") {
        html += `<div class="options">`;
        const respGuardada = respuestasUsuario[idxPregunta];
        q.opciones.forEach((op, iOp) => {
            const checked = respGuardada === iOp ? "checked" : "";
            html += `
                <label class="option">
                    <input type="radio" name="resp" value="${iOp}" ${checked}>
                    <div class="option-text">
                        <span class="es">${op.es}</span>
                        <span class="ua">${op.ua}</span>
                    </div>
                </label>
            `;
        });
        html += `</div>`;
    } else {
        const valor = respuestasUsuario[idxPregunta] ?? "";
        html += `
            <input
                id="short-answer"
                class="short-answer"
                type="text"
                value="${valor}"
                placeholder="Escribe tu respuesta ¬∑ –ù–∞–ø–∏—à–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å"
            >
            <div class="hint">1‚Äì2 palabras son suficientes ¬∑ 1‚Äì2 —Å–ª–æ–≤–∞ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ</div>
        `;
    }

    html += `
        <div class="nav-row">
            <button class="btn btn-ghost" onclick="anterior()" ${indice === 0 ? "disabled" : ""}>
                ‚óÄ Anterior
            </button>
            <button class="btn btn-primary" onclick="siguiente()">
                ${indice === preguntas.length - 1 ? "Terminar test" : "Siguiente ‚ñ∂"}
            </button>
        </div>
    `;

    cont.innerHTML = html;
}

function guardarRespuestaActual() {
    const idxPregunta = orden[indice];
    const q = preguntas[idxPregunta];

    if (q.tipo === "multi") {
        const marcada = document.querySelector("input[name='resp']:checked");
        if (!marcada) return false;
        respuestasUsuario[idxPregunta] = parseInt(marcada.value);
        return true;
    } else {
        const input = document.getElementById("short-answer");
        if (!input) return false;
        const valor = input.value.trim();
        if (valor === "") return false;
        respuestasUsuario[idxPregunta] = valor;
        return true;
    }
}

function siguiente() {
    if (!guardarRespuestaActual()) {
        return; // no avanza si no responde
    }
    indice++;
    if (indice >= preguntas.length) {
        mostrarResultados();
    } else {
        renderPregunta();
    }
}

function anterior() {
    if (indice === 0) return;
    indice--;
    renderPregunta();
}

function mostrarResultados() {
    const testCard = document.getElementById("test-card");
    const resultCard = document.getElementById("result-card");
    const resultContent = document.getElementById("result-content");

    testCard.classList.add("hidden");
    resultCard.classList.remove("hidden");

    let correctas = 0;
    const fallos = [];

    preguntas.forEach((q, idx) => {
        const resp = respuestasUsuario[idx];
        if (resp === null) {
            fallos.push(q);
            return;
        }
        if (q.tipo === "multi") {
            if (resp === q.correcta) correctas++;
            else fallos.push(q);
        } else {
            const esperado = q.respuesta.toLowerCase().trim();
            const dado = String(resp).toLowerCase().trim();
            if (dado === esperado) correctas++;
            else fallos.push(q);
        }
    });

    const total = preguntas.length;
    const errores = total - correctas;

    let html = `
        <h2>Resultados del test</h2>
        <div class="summary">
            ‚úÖ Aciertos: <strong>${correctas}</strong><br>
            ‚ùå Errores: <strong>${errores}</strong>
        </div>
    `;

    if (fallos.length > 0) {
        html += `<div class="summary" style="margin-top:10px;">
            Preguntas que deber√≠as repasar:
        </div>
        <ul class="list-fails">
        `;
        fallos.forEach(q => {
            html += `
                <li>
                    <span class="es">${q.es}</span>
                    <span class="ua">${q.ua}</span>
                </li>
            `;
        });
        html += `</ul>`;
    }

    html += `
        <div class="retry-row">
            <button class="btn btn-primary" onclick="location.reload()">
                üîÅ Volver a hacer el test
            </button>
        </div>
    `;

    resultContent.innerHTML = html;
}

// Iniciar
renderPregunta();
</script>
</body>
</html>
